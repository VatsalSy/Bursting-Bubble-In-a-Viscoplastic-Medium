<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
            <title> - burstingBubble.c</title>
        <link href="http://basilisk.fr/css/custom.css" rel="stylesheet" media="screen, projection" type="text/css" />
    <link href="http://basilisk.fr/css/print.css" rel="stylesheet" media="print" type= "text/css" />
        <!--[if IE]><link href="http://basilisk.fr/css/ie.css" rel="stylesheet" media="screen, projection" type="text/css" /><![endif]-->
    <link rel="stylesheet" href="http://basilisk.fr/css/basilisk.css"/>
    <script src="http://basilisk.fr/js/jquery.min.js" type="text/javascript"></script>
    <script src="http://basilisk.fr/js/jquery-ui.packed.js" type="text/javascript"></script>
    <script src="http://basilisk.fr/js/plots.js" type="text/javascript"></script>
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css"
      integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j"
      crossorigin="anonymous"/>
<script defer
	src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js"
	integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ"
	crossorigin="anonymous">
</script>
  </head>
  <body>
    <div id="doc3" class="yui-t1">
        <div id="yui-main">
          <div id="maincol" class="yui-b">
<div id="userbox">
  <noscript>
    <a href="http://basilisk.fr/_login">Login</a>
    <a href="http://basilisk.fr/_logout">Logout</a>
  </noscript>
  &nbsp;
  <a id="loginlink" class="login" href="http://basilisk.fr/_login">Login / Get an account</a>
  <a id="logoutlink" class="login" href="http://basilisk.fr/_logout">Logout <span id="logged_in_user"></span></a>
</div>
<ul class="tabs">
  <li class=selected><a href="http://basilisk.fr/burstingBubble.c">view</a></li><li><a href="http://basilisk.fr/burstingBubble.c?history">history</a></li>
</ul>
<div id="content">
        <h1 class="pageTitle"><a href="http://basilisk.fr/burstingBubble.c">burstingBubble.c</a></h1>
  <ul class="messages" id="messages"></ul>
  <div id="status"></div>
    <div id="TOC">
<ul>
<li><a href="#introduction">Introduction:</a></li>
<li><a href="#numerical-code">Numerical code</a>
<ul>
<li><a href="#initial-condition">Initial Condition</a></li>
<li><a href="#adaptive-mesh-refinement">Adaptive Mesh Refinement</a></li>
<li><a href="#alternatively">Alternatively</a></li>
<li><a href="#dumping-snapshots">Dumping snapshots</a></li>
<li><a href="#ending-simulations">Ending Simulations</a></li>
<li><a href="#log-writing">Log writing</a></li>
<li><a href="#running-the-code">Running the code</a></li>
</ul></li>
<li><a href="#output-and-results">Output and Results</a>
<ul>
<li><a href="#some-typical-simulations">Some typical simulations</a></li>
</ul></li>
</ul>
</div>
<p>This repository contains the codes used for simulating the cases discussed in the manuscript: Bursting bubble in a viscoplastic medium. The results presented here are currently under review in Journal of Fluid Mechanics. The preprint of the article is available <a href="https://arxiv.org/abs/2101.07744">here</a>.</p>
<p>The supplementary videos are available <a href="https://youtube.com/playlist?list=PLf5C5HCrvhLFETl6iaRr21pzr5Xab1OCM">here</a></p>
<h1 id="introduction">Introduction:</h1>
<p>We investigate the classical problem of bubble bursting at a liquid-gas interface, but now in the presence of a viscoplastic liquid medium. Here are the schematics of the problem. This simualtion will start from Figure 1(c).</p>
<p align="center">
<img src="schematic.png" width="30%">
<caption>
<p align="center">
Schematics for the process of a bursting bubble: (a) A gas bubble in bulk. (b) The bubble approaches the free surface forming a liquid film (thickness <span class="math inline">\delta</span>) between itself and the free surface. (c) A bubble cavity forms when the thin liquid film disappears.
</caption>
</p>
<h1 id="numerical-code">Numerical code</h1>
<p>Id 1 is for the Viscoplastic liquid pool, and Id 2 is Newtonian gas.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&quot;<a href=http://basilisk.fr/src/axi.h>axi.h</a>&quot;</span><span class="pp"><span id=18></span></span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&quot;<a href=http://basilisk.fr/src/navier-stokes/centered.h>navier-stokes/centered.h</a>&quot;</span><span class="pp"><span id=19></span></span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="pp">#define FILTERED </span><span class="co">// Smear density and viscosity jumps<span id=20></span></span></span></code></pre></div>
<p>To model Viscoplastic liquids, we use a modified version of <a href="http://basilisk.fr/src/two-phase.h">two-phase.h</a>. <a href="two-phaseVP.h">two-phaseVP.h</a> contains these modifications.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&quot;<a href=./two-phaseVP.h>two-phaseVP.h</a>&quot;</span><span class="pp"><span id=24></span></span></span></code></pre></div>
<p>You can use: conserving.h as well. Even without it, I was still able to conserve the total energy (also momentum?) of the system if I adapt based on curvature and vorticity/deformation <span class="dt">tensor</span> norm (see the adapt even). I had to smear the density and viscosity anyhow because of the sharp ratios in liquid (Bingham) and the gas.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&quot;<a href=http://basilisk.fr/src/navier-stokes/conserving.h>navier-stokes/conserving.h</a>&quot;</span><span class="pp"><span id=28></span></span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&quot;<a href=http://basilisk.fr/src/tension.h>tension.h</a>&quot;</span><span class="pp"><span id=29></span></span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&quot;<a href=http://basilisk.fr/src/reduced.h>reduced.h</a>&quot;</span><span class="pp"><span id=30></span></span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&quot;<a href=http://basilisk.fr/src/distance.h>distance.h</a>&quot;</span><span class="pp"><span id=31></span></span></span></code></pre></div>
<p>We use a modified adapt-wavelet algorithm available <a href="http://basilisk.fr/sandbox/pairetti/bag_mode/adapt_wavelet_limited.h">(here)</a>. It is written by <em>CÃ©sar Pairetti</em> (Thanks :)).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&quot;<a href=./adapt_wavelet_limited.h>adapt_wavelet_limited.h</a>&quot;</span><span class="pp"><span id=35></span></span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span id=36></span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="pp">#define tsnap (0.001)<span id=37></span></span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a><span class="co">// Error tolerancs<span id=38></span></span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="pp">#define fErr (1e-3)                                 </span><span class="co">// error tolerance in f1 VOF<span id=39></span></span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a><span class="pp">#define KErr (1e-4)                                 </span><span class="co">// error tolerance in f2 VOF<span id=40></span></span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a><span class="pp">#define VelErr (1e-2)                               </span><span class="co">// error tolerances in velocity<span id=41></span></span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a><span class="pp">#define OmegaErr (1e-3)                             </span><span class="co">// error tolerances in vorticity<span id=42></span></span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a><span id=43></span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a><span class="co">// Numbers!<span id=44></span></span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a><span class="pp">#define RHO21 (1e-3)<span id=45></span></span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a><span class="pp">#define MU21 (2e-2)<span id=46></span></span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a><span class="pp">#define Ldomain 8<span id=47></span></span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a><span id=48></span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a><span class="co">// <a href=http://basilisk.fr/Basilisk%20C#boundary-conditions>boundary</a> conditions<span id=49></span></span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a>u.n[right] = neumann(<span class="fl">0.</span>);<span id=50></span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a>p[right] = dirichlet(<span class="fl">0.</span>);<span id=51></span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a><span id=52></span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true"></a><span class="dt">int</span> MAXlevel;<span id=53></span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true"></a><span class="dt">double</span> Oh, Bond, tmax;<span id=54></span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true"></a><span class="dt">char</span> nameOut[<span class="dv">80</span>], dumpFile[<span class="dv">80</span>];<span id=55></span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true"></a><span id=56></span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true"></a><span class="dt">int</span>  <a id=main>main</a>(<span class="dt">int</span> argc, <span class="dt">char</span> <span class="dt">const</span> *argv[]) {<span id=57></span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true"></a>  L0 = Ldomain;<span id=58></span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true"></a>  origin (-L0/<span class="fl">2.</span>, <span class="fl">0.</span>);<span id=59></span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true"></a>  init_grid (<span class="dv">1</span> &lt;&lt; <span class="dv">6</span>);<span id=60></span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true"></a>  <span class="co">// Values taken from the terminal<span id=61></span></span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true"></a>  MAXlevel = <a href=http://man7.org/linux/man-pages/man3/atoi.3.html>atoi</a>(argv[<span class="dv">1</span>]);<span id=62></span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true"></a>  tauy = <a href=http://man7.org/linux/man-pages/man3/atof.3.html>atof</a>(argv[<span class="dv">2</span>]);<span id=63></span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true"></a>  Bond = <a href=http://man7.org/linux/man-pages/man3/atof.3.html>atof</a>(argv[<span class="dv">3</span>]);<span id=64></span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true"></a>  Oh = <a href=http://man7.org/linux/man-pages/man3/atof.3.html>atof</a>(argv[<span class="dv">4</span>]);<span id=65></span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true"></a>  tmax = <a href=http://man7.org/linux/man-pages/man3/atof.3.html>atof</a>(argv[<span class="dv">5</span>]);<span id=66></span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true"></a><span id=67></span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true"></a>  <span class="co">// Ensure that all the variables were transferred properly from the terminal or job script.<span id=68></span></span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true"></a>  <span class="cf">if</span> (argc &lt; <span class="dv">6</span>){<span id=69></span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true"></a>    <a href=http://man7.org/linux/man-pages/man3/fprintf.3.html>fprintf</a>(ferr, <span class="st">&quot;Lack of command line arguments. Check! Need %d more arguments</span><span class="sc">\n</span><span class="st">&quot;</span>,<span class="dv">6</span>-argc);<span id=70></span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true"></a>    <span class="cf">return</span> <span class="dv">1</span>;<span id=71></span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true"></a>  }<span id=72></span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true"></a>  <a href=http://man7.org/linux/man-pages/man3/fprintf.3.html>fprintf</a>(ferr, <span class="st">&quot;Level %d, Oh %2.1e, Tauy %4.3f, Bo %4.3f</span><span class="sc">\n</span><span class="st">&quot;</span>, MAXlevel, Oh, tauy, Bond);<span id=73></span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true"></a><span id=74></span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true"></a>  <span class="co">// Create a folder named intermediate where all the simulation snapshots are stored.<span id=75></span></span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true"></a>  <span class="dt">char</span> comm[<span class="dv">80</span>];<span id=76></span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true"></a>  <a href=http://man7.org/linux/man-pages/man3/sprintf.3.html>sprintf</a> (comm, <span class="st">&quot;mkdir -p intermediate&quot;</span>);<span id=77></span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true"></a>  <a href=http://man7.org/linux/man-pages/man3/system.3.html>system</a>(comm);<span id=78></span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true"></a>  <span class="co">// Name of the restart file. See writingFiles <a href=http://basilisk.fr/Basilisk%20C#events>event</a>.<span id=79></span></span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true"></a>  <a href=http://man7.org/linux/man-pages/man3/sprintf.3.html>sprintf</a> (dumpFile, <span class="st">&quot;dump&quot;</span>);<span id=80></span><span id=81></span></span></code></pre></div>
<p>We consider the burst of a small axisymmetric bubble at a surface of an incompressible Bingham fluid. To nondimensionalise the governing equations, we use the initial bubble radius <span class="math inline">R_0</span>, and inertia-capillary velocity <span class="math inline">V_\gamma = \sqrt{\gamma/(\rho_lR_0)}</span>, respectively. Pressure and stresses are scaled with the characteristic capillary pressure, <span class="math inline">\gamma/R_0</span>. The dimensionless equations for mass and momentum conservation, for the liquid phase, then read</p>
<p><span class="math display">
\nabla \cdot \boldsymbol{u} = 0
</span> <span class="math display">
\frac{\partial\boldsymbol{u}}{\partial t} + \nabla\boldsymbol{\cdot}\left(\boldsymbol{uu}\right) = -\nabla p + \nabla\boldsymbol{\cdot}\boldsymbol{\tau} - \mathcal{B}o\,\hat{\boldsymbol{e}}_{\boldsymbol{\mathcal{Z}}},
</span> where <span class="math inline">\boldsymbol{u}</span> is the velocity <span class="dt">vector</span>, <span class="math inline">t</span> is time, <span class="math inline">p</span> is the pressure and <span class="math inline">\boldsymbol{\tau}</span> represents the deviatoric stress <span class="dt">tensor</span>. We use the regularized Bingham model with <span class="math display">
\boldsymbol{\tau} = 2\,\text{min}\left(\frac{\mathcal{J}}{2\|\boldsymbol{\mathcal{D}}\|} + \mathcal{O}h, \mathcal{O}h_\text{max}\right)\boldsymbol{\mathcal{D}}
</span> where <span class="math inline">\|\boldsymbol{\mathcal{D}}\|</span> is the second invariant of the deformation rate <span class="dt">tensor</span>, <span class="math inline">\boldsymbol{\mathcal{D}}</span>, and <span class="math inline">\mathcal{O}h_{max}</span> is the viscous regularisation parameter. The three dimensionless numbers controlling the equations above are the capillary-Bingham number <span class="math inline">\left(\mathcal{J}\right)</span>, which accounts for the competition between the capillary and yield stresses, the Ohnesorge number <span class="math inline">\left(\mathcal{O}h\right)</span> that compares the inertial-capillary to inertial-viscous time scales, and the Bond number <span class="math inline">\left(\mathcal{B}o\right)</span>, which compares gravity and surface tension forces: <span class="math display">
\mathcal{J} = \frac{\tau_yR_0}{\gamma},\,\,\mathcal{O}h = \frac{\mu_l}{\sqrt{\rho_l\gamma R_0}},\,\,\mathcal{B}o = \frac{\rho_l gR_o^2}{\gamma}.
</span></p>
<p>Here, <span class="math inline">\gamma</span> is the liquid-gas surface tension coefficient, and <span class="math inline">\tau_y</span> and <span class="math inline">\rho_l</span> are the liquidâs yield stress and density, respectively. Next, <span class="math inline">\mu_l</span> is the constant viscosity in the Bingham model. Note that in our simulations, we also solve the fluidâs motion in the gas phase, using a similar set of equations (Newtonian). Hence, the further relevant non-dimensional groups in addition to those above are the ratios of density <span class="math inline">\left(\rho_r = \rho_g/\rho_l\right)</span> and viscosity <span class="math inline">\left(\mu_r = \mu_g/\mu_l\right)</span>. In the present study, these ratios are kept fixed at <span class="math inline">10^{-3}</span> and <span class="math inline">2 \times 10^{-2}</span>, respectively (see above).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>  mumax = <span class="fl">1e8</span>*Oh;  <span class="co">// The regularisation value of viscosity<span id=103></span></span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>  rho1 = <span class="fl">1.</span>, rho2 = RHO21;<span id=104></span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>  mu1 = Oh, mu2 = MU21*Oh;<span id=105></span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>  f.sigma = <span class="fl">1.0</span>;<span id=106></span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>  G.x = -Bond;<span id=107></span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>  run();<span id=108></span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>}<span id=109></span><span id=110></span></span></code></pre></div>
<p>This event is specific to CÃ©sarâs adapt_wavelet_limited.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="dt">int</span> <a id=refRegion>refRegion</a>(<span class="dt">double</span> x, <span class="dt">double</span> y, <span class="dt">double</span> z){<span id=114></span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>  <span class="cf">return</span> (y &lt; <span class="fl">1.28</span> ? MAXlevel+<span class="dv">2</span> : y &lt; <span class="fl">2.56</span> ? MAXlevel+<span class="dv">1</span> : y &lt; <span class="fl">5.12</span> ? MAXlevel : MAXlevel-<span class="dv">1</span>);<span id=115></span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>}<span id=116></span><span id=117></span></span></code></pre></div>
<h2 id="initial-condition">Initial Condition</h2>
<p>The initial shape of the bubble at the liquid-gas interface can be calculated by solving the Young-Laplace equations (<a href="https://doi.org/10.1017/jfm.2011.418â">Lhuissier &amp; Villermaux, 2012</a>) and it depends on the <span class="math inline">\mathcal{B}o</span> number. Resources:</p>
<ul>
<li><a href="http://www.basilisk.fr/sandbox/aberny/bubble/bubble.c">Alex Bernyâs Sandbox</a></li>
<li><a href="https://www.dropbox.com/s/3pqbs901dshq5wa/InitialCondition.m?dl=0">My Matlab code:</a> Also see the results for different <span class="math inline">\mathcal{B}o</span> number <a href="https://youtu.be/Z_vdsOW5fsg">here</a>.</li>
</ul>
<p align="center">
<img src="VillermauxComparision.png" width="25%">
<caption>
<p align="center">
Comparision of the initial shape calculated using the Young-Laplace equations. Ofcourse, for this study, we only need: <span class="math inline">\mathcal{B}o = 10^{-3}</span>. In the figure, <span class="math inline">a</span> is the capillary length, <span class="math inline">a = \sqrt{\gamma/(\rho_lg)}</span>
</caption>
</p>
<p>Since we do not focus on the influence of <span class="math inline">\mathcal{B}o</span> number in the present study, I am not elaborating on it here. For all the simulations, I use the interfacial shape calculated for <span class="math inline">\mathcal{B}o = 10^{-3}</span>. The resultant data file is available <a href="https://www.dropbox.com/s/8let8wohwq2qxeq/Bo0.0010.dat?dl=0">here</a>.</p>
<p><strong>Note:</strong> The curvature diverges at the cavity-free surface intersection. We fillet this corner to circumvent this singularity, introducing a rim with a finite curvature that connects the bubble to the free surface. We ensured that the curvature of the rim is high enough such that the subsequent dynamics are independent of its finite value.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><a href=http://basilisk.fr/Basilisk%20C#events>event</a> <a id=init>init</a> (t = <span class="dv">0</span>) {<span id=136></span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>  <span class="cf">if</span> (!restore (file = dumpFile)){<span id=137></span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span id=138></span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>    <span class="dt">char</span> filename[<span class="dv">60</span>];<span id=139></span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>    <a href=http://man7.org/linux/man-pages/man3/sprintf.3.html>sprintf</a>(filename,<span class="st">&quot;Bo%5.4f.dat&quot;</span>,Bond);<span id=140></span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a>    <span class="dt">FILE</span> * fp = <a href=http://man7.org/linux/man-pages/man3/fopen.3.html>fopen</a>(filename,<span class="st">&quot;rb&quot;</span>);<span id=141></span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a>    <span class="cf">if</span> (fp == NULL){<span id=142></span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a>      <a href=http://man7.org/linux/man-pages/man3/fprintf.3.html>fprintf</a>(ferr, <span class="st">&quot;There is no file named %s</span><span class="sc">\n</span><span class="st">&quot;</span>, filename);<span id=143></span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a>      <span class="cf">return</span> <span class="dv">1</span>;<span id=144></span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a>    }<span id=145></span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true"></a>    coord* InitialShape;<span id=146></span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true"></a>    InitialShape = input_xy(fp);<span id=147></span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true"></a>    <a href=http://man7.org/linux/man-pages/man3/fclose.3.html>fclose</a> (fp);<span id=148></span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true"></a>    <span class="dt">scalar</span> d[];<span id=149></span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true"></a>    distance (d, InitialShape);<span id=150></span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true"></a>    <span class="cf">while</span> (adapt_wavelet_limited ((<span class="dt">scalar</span> *){f, d}, (<span class="dt">double</span>[]){<span class="fl">1e-8</span>, <span class="fl">1e-8</span>}, refRegion).nf);<span id=151></span></span></code></pre></div>
<p>The distance function is defined at the center of each cell, we have to calculate the value of this function at each vertex.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>    <a href=http://basilisk.fr/Basilisk%20C#face-and-vertex-fields>vertex</a> <span class="dt">scalar</span> phi[];<span id=155></span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>    <a href=http://basilisk.fr/Basilisk%20C#foreach_vertex>foreach_vertex</a>(){<span id=156></span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>      phi[] = -(d[] + d[-<span class="dv">1</span>] + d[<span class="dv">0</span>,-<span class="dv">1</span>] + d[-<span class="dv">1</span>,-<span class="dv">1</span>])/<span class="fl">4.</span>;<span id=157></span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>    }<span id=158></span></span></code></pre></div>
<p>We can now initialize the volume fraction of the domain.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>    fractions (phi, f);<span id=161></span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a>  }<span id=162></span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a>}<span id=163></span><span id=164></span></span></code></pre></div>
<h2 id="adaptive-mesh-refinement">Adaptive Mesh Refinement</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><a href=http://basilisk.fr/Basilisk%20C#events>event</a> <a id=adapt>adapt</a>(i++){<span id=168></span></span></code></pre></div>
<p>We adapt based on curvature, <span class="math inline">\kappa</span> and vorticity <span class="math inline">\omega</span>. Adaptation based on <span class="math inline">\kappa</span> ensures a constant grid resolution across the interface. See <a href="http://basilisk.fr/sandbox/Antoonvh/rc.c">this</a> for further reading.</p>
<p>We also adapt based on vorticity in the liquid domain. I have noticed that this refinement helps resolve the fake-yield surface accurately (see the black regions in the videos below).</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>  <span class="dt">scalar</span> KAPPA[], omega[];<span id=175></span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>  curvature(f, KAPPA);<span id=176></span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>  vorticity (u, omega);<span id=177></span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>  <a href=http://basilisk.fr/Basilisk%20C#iterators>foreach</a>(){<span id=178></span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a>    omega[] *= f[];<span id=179></span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>  }<span id=180></span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>  <a href=http://basilisk.fr/Basilisk%20C#boundary-conditions>boundary</a> ((<span class="dt">scalar</span> *){KAPPA, omega});<span id=181></span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a>  adapt_wavelet_limited ((<span class="dt">scalar</span> *){f, u.x, u.y, KAPPA, omega},<span id=182></span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>     (<span class="dt">double</span>[]){fErr, VelErr, VelErr, KErr, OmegaErr},<span id=183></span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a>     refRegion);<span id=184></span></span></code></pre></div>
<h2 id="alternatively">Alternatively</h2>
<p>At higher <span class="math inline">\mathcal{O}h</span> and <span class="math inline">\mathcal{J}</span> numbers, vorticities in the liquid cease to be interesting. In that case, one might want to adapt based on the norm of deformation <span class="dt">tensor</span>, <span class="math inline">\mathbf{\mathcal{D}}</span>. I already calculate <span class="math inline">\|\mathbf{\mathcal{D}}\|</span> in <a href="two-phaseVP.h">two-phaseVP.h</a>.</p>
<p><strong>Note:</strong> <span class="math inline">\mathbf{\mathcal{D}}</span> based refinement is way more expensive than <span class="math inline">\omega</span> based refinement.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a>  <span class="co">// adapt_wavelet_limited ((<span class="dt">scalar</span> *){f, u.x, u.y, KAPPA, D2},<span id=191></span></span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a>  <span class="co">//    (double[]){fErr, VelErr, VelErr, KErr, 1e-3},<span id=192></span></span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a>  <span class="co">//    refRegion);<span id=193></span></span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a>}<span id=194></span><span id=195></span></span></code></pre></div>
<h2 id="dumping-snapshots">Dumping snapshots</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><a href=http://basilisk.fr/Basilisk%20C#events>event</a> <a id=writingFiles>writingFiles</a> (t = <span class="dv">0</span>; t += tsnap; t &lt;= tmax) {<span id=199></span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>  dump (file = dumpFile);<span id=200></span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>  <a href=http://man7.org/linux/man-pages/man3/sprintf.3.html>sprintf</a> (nameOut, <span class="st">&quot;intermediate/snapshot-%5.4f&quot;</span>, t);<span id=201></span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>  dump(file=nameOut);<span id=202></span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a>}<span id=203></span><span id=204></span></span></code></pre></div>
<h2 id="ending-simulations">Ending Simulations</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><a href=http://basilisk.fr/Basilisk%20C#events>event</a> <a id=end>end</a> (t = end) {<span id=208></span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a>  <a href=http://man7.org/linux/man-pages/man3/fprintf.3.html>fprintf</a>(ferr, <span class="st">&quot;Done: Level %d, Oh %2.1e, Tauy %4.3f, Bo %4.3f</span><span class="sc">\n</span><span class="st">&quot;</span>, MAXlevel, Oh, tauy, Bond);<span id=209></span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>}<span id=210></span><span id=211></span></span></code></pre></div>
<h2 id="log-writing">Log writing</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><a href=http://basilisk.fr/Basilisk%20C#events>event</a> <a id=logWriting>logWriting</a> (i+=<span class="dv">100</span>) {<span id=215></span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a>  <span class="dt">double</span> ke = <span class="fl">0.</span>;<span id=216></span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a>  <a href=http://basilisk.fr/Basilisk%20C#iterators>foreach</a> (<a href=http://basilisk.fr/Basilisk%20C#parallel-programming>reduction</a>(+:ke)){<span id=217></span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a>    ke += (<span class="dv">2</span>*pi*y)*(<span class="fl">0.5</span>*(f[])*(sq(u.x[]) + sq(u.y[])))*sq(Delta);<span id=218></span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a>  }<span id=219></span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a>  <span class="dt">static</span> <span class="dt">FILE</span> * fp;<span id=220></span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a>  <span class="cf">if</span> (i == <span class="dv">0</span>) {<span id=221></span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a>    <a href=http://man7.org/linux/man-pages/man3/fprintf.3.html>fprintf</a> (ferr, <span class="st">&quot;i dt t ke</span><span class="sc">\n</span><span class="st">&quot;</span>);<span id=222></span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a>    fp = <a href=http://man7.org/linux/man-pages/man3/fopen.3.html>fopen</a> (<span class="st">&quot;log&quot;</span>, <span class="st">&quot;w&quot;</span>);<span id=223></span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true"></a>    <a href=http://man7.org/linux/man-pages/man3/fprintf.3.html>fprintf</a> (fp, <span class="st">&quot;i dt t ke</span><span class="sc">\n</span><span class="st">&quot;</span>);<span id=224></span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true"></a>    <a href=http://man7.org/linux/man-pages/man3/fprintf.3.html>fprintf</a> (fp, <span class="st">&quot;%d %g %g %g</span><span class="sc">\n</span><span class="st">&quot;</span>, i, dt, t, ke);<span id=225></span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true"></a>    <a href=http://man7.org/linux/man-pages/man3/fclose.3.html>fclose</a>(fp);<span id=226></span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true"></a>  } <span class="cf">else</span> {<span id=227></span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true"></a>    fp = <a href=http://man7.org/linux/man-pages/man3/fopen.3.html>fopen</a> (<span class="st">&quot;log&quot;</span>, <span class="st">&quot;a&quot;</span>);<span id=228></span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true"></a>    <a href=http://man7.org/linux/man-pages/man3/fprintf.3.html>fprintf</a> (fp, <span class="st">&quot;%d %g %g %g</span><span class="sc">\n</span><span class="st">&quot;</span>, i, dt, t, ke);<span id=229></span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true"></a>    <a href=http://man7.org/linux/man-pages/man3/fclose.3.html>fclose</a>(fp);<span id=230></span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true"></a>  }<span id=231></span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true"></a>  <a href=http://man7.org/linux/man-pages/man3/fprintf.3.html>fprintf</a> (ferr, <span class="st">&quot;%d %g %g %g</span><span class="sc">\n</span><span class="st">&quot;</span>, i, dt, t, ke);<span id=232></span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true"></a>  <span class="cf">if</span> (ke &gt; <span class="fl">1e3</span> || ke &lt; <span class="fl">1e-6</span>){<span id=233></span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true"></a>    <span class="cf">if</span> (i &gt; <span class="fl">1e2</span>){<span id=234></span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true"></a>      <span class="cf">return</span> <span class="dv">1</span>;<span id=235></span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true"></a>    }<span id=236></span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true"></a>  }<span id=237></span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true"></a>}<span id=238></span><span id=239></span></span></code></pre></div>
<h2 id="running-the-code">Running the code</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a><span class="co">#!/bin/bash</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a><span class="ex">qcc</span> -fopenmp -Wall -O2 burstingBubble.c -o burstingBubble -lm</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a><span class="bu">export</span> <span class="va">OMP_NUM_THREADS=</span>8</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a><span class="ex">./burstingBubble</span> 10 0.25 1e-3 1e-2 5.0</span></code></pre></div>
<h1 id="output-and-results">Output and Results</h1>
<p>The post-processing codes and simulation data are available at: <a href="https://www.dropbox.com/sh/upl2m01icn364lv/AAACI2tgcaTrpG6x7UEoBQ5Fa?dl=0">PostProcess</a></p>
<h2 id="some-typical-simulations">Some typical simulations</h2>
<div id="wrapper">
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/DY6TpfzZ2fM" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/vYxNehfcKac" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/PJbKsEjIbjQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/aJbnD8wAPmQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
<div class="center-block">

</div>
</div>
<p>Bursting bubble dynamics for different capillary-Bingham numbers. (a) <span class="math inline">\mathcal{J} = 0.0</span>: A typical case with a Newtonian liquid medium, (b) <span class="math inline">\mathcal{J} =0.1</span>: A weakly viscoplastic liquid medium in which the process still shows all the major characteristics of the Newtonian liquid, (c) <span class="math inline">\mathcal{J} = 0.5</span>: A case of moderate yield stress whereby the jetting is suppressed, nonetheless the entire cavity still yields, and (d) <span class="math inline">\mathcal{J} = 1.0</span>: A highly viscoplastic liquid medium whereby a part of the cavity never yields. The left part of each video shows the magnitude of the velocity field, and the right part shows the magnitude of the deformation <span class="dt">tensor</span> on a <span class="math inline">\log_{10}</span> scale. The transition to the black region (low strain rates) marks the yield-surface location in the present study. For all the cases in this figure, <span class="math inline">\mathcal{O}h = 10^{-2}</span>.</p>
</div>
<div id="footer">
inspired by <a href="http://github.com/jgm/gitit/tree/master/">gitit</a>,
powered by <a href="http://basilisk.fr/src/darcsit/README">darcsit</a>
</div>
          </div>
        </div>
        <div id="sidebar" class="yui-b first">
<div id="logo">
  <a href="http://basilisk.fr/" alt="site logo" title="Go to top page"><img src="http://basilisk.fr/img/logo.png" /></a>
</div>
          <div class="sitenav">
  <fieldset>
    <legend>Site</legend>
    <ul>
      <li><a href="http://basilisk.fr/Front Page">Front page</a></li>
      <li><a href="http://basilisk.fr/_index">All pages</a></li>
      <li><a href="http://basilisk.fr/_activity">Recent activity</a></li>
            <li><a href="http://basilisk.fr/Help">Help</a></li>
    </ul>
    <form action="/_search" method="get" id="searchform">
      <input type="text" name="patterns" id="patterns"/>
      <input type="submit" value="Search"/>
    </form>
  </fieldset>
  <fieldset>
    <legend>Documentation</legend>
    <ul>
      <li><a href="http://basilisk.fr/Tutorial">Tutorial</a></li>
      <li><a href="http://basilisk.fr/src/INSTALL">Installation</a></li>
      <li><a href="http://basilisk.fr/Basilisk C">Basilisk C</a></li>
      <li><a href="http://basilisk.fr/src/README">Solvers and functions</a></li>
      <li><a href="http://basilisk.fr/src/examples/README">Examples</a></li>
      <li><a href="http://groups.google.com/d/forum/basilisk-fr">User forum</a></li>
      <li><a href="http://basilisk.fr/sandbox/documentation">More documentation</a></li>
    </ul>
  </fieldset>
  <fieldset>
    <legend>Development</legend>
    <ul>
      <li><a href="http://basilisk.fr/src/?history">Recent activity</a></li>
      <li><a href="http://basilisk.fr/src/">Source code</a></li>
      <li><a href="https://hub.darcs.net/basilisk/basilisk/browse/src">Darcs Hub</a></li>
      <li><a href="http://basilisk.fr/src/test/README">Test cases</a></li>
      <li><a href="http://basilisk.fr/sandbox/bugs/README">Bug reports</a></li>
      <li><a href="http://basilisk.fr/src/Contributing">How to contribute</a></li>
      <li><a href="http://basilisk.fr/sandbox/">Play in the sandbox</a></li>
    </ul>
  </fieldset>
</div>
                    <div class="pageTools">
  <fieldset>
    <legend>This page</legend>
    <ul>
      <li><a href="http://basilisk.fr/burstingBubble.c?raw">Raw page source</a></li>
      <li><a href="http://basilisk.fr/burstingBubble.c?delete">Delete this page</a></li>
    </ul>
  </fieldset>
</div>
                            </div>
    </div>
    <script src="/js/status.js" type="text/javascript"></script>
      </body>
</html>
